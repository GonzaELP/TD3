     1                                  [ORG 0x7C00];BIOS loads bootsector here
     2                                  
     3                                  %ifndef KERNEL_MEMORY
     4                                  	%error "Kernel start address not defined"
     5                                  	;kernel_memory must be 16 byte aligned
     6                                  %endif	
     7                                  
     8                                  %ifndef KERNEL_SIZE_SECTORS
     9                                  	%error "Kernel size (in sectors) not defined"
    10                                  %endif	
    11                                  
    12                                  [BITS 16]   ;for real mode; 16-bit instructions
    13 00000000 FA                      	cli		                       ;clear interrupts
    14                                  ;-----------------------------------------------------------
    15                                  ; INITIALIZATION PROCEDURES
    16                                          
    17 00000001 B402                    	mov	ah, 02h			; load int 13h function (read sector)
    18 00000003 B001                    	mov	al,KERNEL_SIZE_SECTORS  ; load how many sectors will be read
    19 00000005 B90200                          mov	cx, 02h			; starting from track 0, sector 2
    20 00000008 B600                    	mov	dh, 0			; load head = 0
    21 0000000A B200                    	mov 	dl, 0 			; drive 0 (A:)
    22 0000000C 66BB00800000            	mov	ebx, KERNEL_MEMORY	; load linear destination address at ebx
    23 00000012 66C1EB04                	shr	ebx,4			; shift right ebx (result at BX will be the segment)
    24 00000016 8EC3                    	mov	es,bx			; load destination segment
    25 00000018 BB0000                  	mov	bx, 0			; load 0 offset  
    26                                      	
    27 0000001B CD13                    int	13h			; read disk
    28                                  
    29                                  ;---------------------------------------------------------------------------         
    30                                          
    31 0000001D 7205                     jc      error                   ; if carry is set, int 13h didn't work
    32 0000001F EA00000008                      jmp     (KERNEL_MEMORY>>4):0    ; jmp to the kernel code
    33                                  
    34                                  error:
    35 00000024 F4                         	hlt
    36                                  
    37 00000025 00<rept>                    times   510-($-$$)  db 0 ;fill the space till 510 
    38                                                               ;with zeroes
    39                                  
    40 000001FE 55AA                        dw 0xAA55                ;boot sector identifier
